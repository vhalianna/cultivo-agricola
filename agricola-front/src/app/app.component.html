<div class="container py-5">
  <div class="text-center mb-5">
    <h1 class="display-5 fw-bold text-success"> Sistema Experto Agr铆cola</h1>
    <p class="lead text-muted">Asesor铆a t茅cnica automatizada basada en reglas Drools</p>
  </div>

  <div class="row g-5">
    <div class="col-lg-5">
      <div class="card shadow-sm border-0 bg-light">
        <div class="card-body p-4">
          <h4 class="card-title mb-4 text-primary"> Condiciones del Cultivo</h4>

          <form (ngSubmit)="evaluar()">

            <div class="mb-3">
              <label class="form-label fw-bold">Tipo de Cultivo</label>
              <select class="form-select" [(ngModel)]="situacion.cultivo" name="cultivo">
                <option *ngFor="let c of cultivos" [value]="c">{{c}}</option>
              </select>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small">pH Suelo</label>
                <select class="form-select" [(ngModel)]="situacion.ph_suelo" name="ph">
                  <option *ngFor="let n of niveles" [value]="n">{{n}}</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label small">Nutrientes</label>
                <select class="form-select" [(ngModel)]="situacion.nutrientes" name="nutrientes">
                  <option *ngFor="let n of nutrientes" [value]="n">{{n}}</option>
                </select>
              </div>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small">Temperatura</label>
                <select class="form-select" [(ngModel)]="situacion.temperatura" name="temp">
                  <option *ngFor="let t of nivelesTemp" [value]="t">{{t}}</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label small">Lluvias</label>
                <select class="form-select" [(ngModel)]="situacion.precipitaciones" name="lluvias">
                  <option *ngFor="let p of precipitaciones" [value]="p">{{p}}</option>
                </select>
              </div>
            </div>

            <div class="row g-2 mb-3">
              <div class="col-6">
                <label class="form-label small">Hum. Suelo</label>
                <select class="form-select" [(ngModel)]="situacion.humedad_suelo" name="hsuelo">
                  <option *ngFor="let n of niveles" [value]="n">{{n}}</option>
                </select>
              </div>
              <div class="col-6">
                <label class="form-label small">Hum. Ambiente</label>
                <select class="form-select" [(ngModel)]="situacion.humedad_amb" name="hamb">
                  <option *ngFor="let n of niveles" [value]="n">{{n}}</option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label fw-bold">Situaci贸n Biol贸gica</label>
              <div class="input-group mb-2">
                <span class="input-group-text">Plaga</span>
                <select class="form-select" [(ngModel)]="situacion.plaga" name="plaga">
                  <option *ngFor="let p of plagas" [value]="p">{{p}}</option>
                </select>
              </div>
              <div class="input-group">
                <span class="input-group-text">Historial</span>
                <select class="form-select" [(ngModel)]="situacion.historial_plagas" name="historial">
                  <option *ngFor="let h of historial" [value]="h">{{h}}</option>
                </select>
              </div>
            </div>

            <button type="submit" class="btn btn-success w-100 py-2 fw-bold shadow-sm"
                    [disabled]="loading">
              <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
              {{ loading ? 'PROCESANDO REGLAS...' : 'CONSULTAR EXPERTO' }}
            </button>

            <div *ngIf="errorMessage" class="alert alert-danger mt-3 small">
              {{ errorMessage }}
            </div>
          </form>
        </div>
      </div>
    </div>

    <div class="col-lg-7">
      <div *ngIf="!resultado" class="h-100 d-flex flex-column justify-content-center align-items-center text-muted border rounded-3 bg-light p-5">
        <div style="font-size: 4rem;"></div>
        <p class="mt-3">Complete los datos y presione "Consultar Experto"</p>
      </div>

      <div *ngIf="resultado" class="card shadow border-success h-100">
        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"> Diagn贸stico Final</h5>
          <span class="badge bg-light text-success">Reglas Ejecutadas</span>
        </div>

        <div class="card-body">
          <div *ngIf="resultado.alerta === 'SI'" class="alert alert-danger d-flex align-items-center mb-4">
            <div class="fs-1 me-3"></div>
            <div>
              <h5 class="alert-heading fw-bold mb-1">隆ALERTA!</h5>
              <p class="mb-0 small">Condiciones extremas fuera de rango. Se requiere intervenci贸n inmediata.</p>
            </div>
          </div>

          <div class="row g-4">
            <div class="col-md-6">
              <div class="p-3 bg-light rounded-3 border h-100">
                <h6 class="text-secondary text-uppercase small fw-bold mb-3">Estrategia General</h6>

                <div class="mb-3">
                  <label class="small text-muted d-block">Nivel de Riesgo</label>
                  <span class="fs-5 fw-bold"
                        [class.text-danger]="resultado.riesgo === 'ALTO'"
                        [class.text-warning]="resultado.riesgo === 'MEDIO'"
                        [class.text-success]="resultado.riesgo === 'BAJO'">
                    {{ resultado.riesgo }}
                  </span>
                </div>

                <div>
                  <label class="small text-muted d-block">Manejo Recomendado</label>
                  <span class="badge fs-6"
                        [class.bg-danger]="resultado.manejo === 'INTEGRADO'"
                        [class.bg-warning]="resultado.manejo === 'PREVENTIVO'"
                        [class.bg-success]="resultado.manejo === 'CONVENCIONAL'">
                    {{ resultado.manejo }}
                  </span>
                </div>
              </div>
            </div>

            <div class="col-md-6">
              <div class="p-3 bg-light rounded-3 border h-100">
                <h6 class="text-secondary text-uppercase small fw-bold mb-3">Acciones Correctivas</h6>

                <ul class="list-unstyled mb-0">
                  <li class="mb-2 d-flex justify-content-between border-bottom pb-2">
                    <span> Control Plaga:</span>
                    <strong class="text-primary">{{ resultado.control_plaga }}</strong>
                  </li>
                  <li class="mb-2 d-flex justify-content-between border-bottom pb-2">
                    <span>И Enmienda:</span>
                    <strong class="text-dark">{{ resultado.enmienda_suelo }}</strong>
                  </li>
                  <li class="d-flex justify-content-between">
                    <span> Riego:</span>
                    <strong class="text-info">{{ resultado.riego }}</strong>
                  </li>
                </ul>
              </div>
            </div>
          </div>

          <div class="mt-4 pt-3 border-top text-center">
            <span class="badge bg-secondary me-2">Fertilizaci贸n: {{ resultado.fertilizacion }}</span>
          </div>

        </div>
      </div>
    </div>
  </div>
</div>
